// ======== 폴리곤 경로 추출 (WGS84, 재귀로 모든 path 펼치기) ========
function getPolygonPointsWgs84(polygon) {
  const points = [];
  if (!polygon || typeof polygon.getPath !== "function") {
    log("[ERR] getPolygonPointsWgs84: polygon 또는 getPath 없음", "err");
    return points;
  }

  const rawPath = polygon.getPath();

  const walk = (p) => {
    if (!p) return;

    // 1) LatLng 한 점
    if (
      p instanceof kakao.maps.LatLng ||
      (typeof p.getLat === "function" && typeof p.getLng === "function")
    ) {
      const lat = p.getLat();
      const lng = p.getLng();
      if (typeof lat === "number" && typeof lng === "number" &&
          isFinite(lat) && isFinite(lng)) {
        points.push({ lat, lng });
      }
      return;
    }

    // 2) LatLngPath (getLength / getAt 존재)
    if (typeof p.getLength === "function" && typeof p.getAt === "function") {
      const len = p.getLength();
      for (let i = 0; i < len; i++) {
        walk(p.getAt(i));
      }
      return;
    }

    // 3) 배열 (LatLng[] 혹은 그 배열의 배열)
    if (Array.isArray(p)) {
      p.forEach(walk);
      return;
    }
  };

  walk(rawPath);

  return points;
}
