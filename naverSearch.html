<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>네이버 뉴스 검색</title>
  <style>
    body { font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif; margin: 24px; }
    .header { display:flex; align-items: baseline; gap: 12px; margin-bottom: 16px; }
    h1 { margin: 0; font-size: 32px; }
    #preset { padding: 8px 10px; font-size: 14px; }

    .row { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    input { flex:1; padding:10px 12px; font-size:16px; }
    button { padding:10px 12px; font-size:16px; cursor:pointer; }
    select { padding:6px 8px; }

    #status { margin: 10px 0 12px; font-weight: 600; }

    .item { padding: 10px 0; }
    .title {
      display:block;
      font-size: 18px;
      font-weight: 800;
      color:#111;
      text-decoration:none;
      line-height: 1.35;
    }
    .title:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="header">
    <h1>네이버 뉴스 검색</h1>
    <select id="preset" title="키워드 선택">
      <option value="">키워드 선택…</option>
      <option value="쿠팡CLS">쿠팡CLS</option>
      <option value="쿠팡">쿠팡</option>
      <option value="쿠팡퀵플렉스">쿠팡퀵플렉스</option>
      <option value="쿠팡파트너스연합회">쿠팡파트너스연합회</option>
      <option value="쿠팡택배">쿠팡택배</option>
      <option value="쿠팡CES">쿠팡CES</option>
      <option value="쿠팡CFS">쿠팡CFS</option>
    </select>
  </div>

  <div class="row">
    <input id="q" placeholder="키워드 입력 (예: 쿠팡CLS)" />
    <button id="btn">검색</button>
  </div>

  <div class="row">
    <label>정렬:
      <select id="sort">
        <option value="sim" selected>관련도순</option>
        <option value="date">최신순</option>
      </select>
    </label>

    <label>개수:
      <select id="display">
        <option>10</option><option>20</option><option>30</option><option>50</option>
      </select>
    </label>
  </div>

  <div id="status"></div>
  <div id="list"></div>

  <script>
    const $ = (id) => document.getElementById(id);

    async function search() {
      const qEl = $("q");
      const statusEl = $("status");
      const listEl = $("list");

      const query = (qEl?.value || "").trim();
      if (!query) return;

      statusEl.textContent = "검색 중...";
      listEl.innerHTML = "";

      const sort = $("sort").value;      // sim | date
      const display = $("display").value;

      const api = `/newsSearch?query=${encodeURIComponent(query)}&sort=${encodeURIComponent(sort)}&display=${encodeURIComponent(display)}`;

      let res;
      try {
        res = await fetch(api);
      } catch (e) {
        statusEl.textContent = "에러: API 호출 실패 (네트워크/Worker 확인)";
        return;
      }

      if (!res.ok) {
        statusEl.textContent = "에러: " + await res.text();
        return;
      }

      const data = await res.json();
      const items = data.items || [];
      statusEl.textContent = `총 ${data.total ?? "?"}건 / 현재 ${items.length}건`;

      for (const it of items) {
        const div = document.createElement("div");
        div.className = "item";

        const a = document.createElement("a");
        a.className = "title";
        a.href = it.link;
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.textContent = it.title;

        div.appendChild(a);
        listEl.appendChild(div);
      }
    }

    function setKeywordAndSearch(keyword) {
      $("q").value = keyword;
      $("preset").value = keyword; // 옵션에 없으면 무시됨
      search();
    }

    document.addEventListener("DOMContentLoaded", () => {
      // 이벤트 바인딩
      $("btn").addEventListener("click", search);
      $("q").addEventListener("keydown", (e) => { if (e.key === "Enter") search(); });
      $("preset").addEventListener("change", () => {
        const v = $("preset").value;
        if (v) setKeywordAndSearch(v);
      });

      // ✅ 첫 진입 자동 검색: 쿠팡CLS
      // (원하면 /naverSearch.html?k=쿠팡 처럼 k로 override 가능)
      const params = new URLSearchParams(location.search);
      const k = (params.get("k") || "").trim();
      setKeywordAndSearch(k || "쿠팡CLS");
    });
  </script>
</body>
</html>
